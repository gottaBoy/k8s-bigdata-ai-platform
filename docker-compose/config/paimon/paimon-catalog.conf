# Paimon Catalog配置文件
# 用于配置Paimon数据湖的Catalog

# 默认Catalog配置
catalogs:
  - name: paimon
    type: paimon
    warehouse: s3://bigdata-lake/paimon
    s3.endpoint: http://minio:9000
    s3.access-key: admin
    s3.secret-key: minio123
    s3.path.style: true
    s3.region: us-east-1
    s3.connection.maximum: 100
    s3.connection.timeout: 30000
    s3.socket.timeout: 30000
    s3.retry.max: 3
    s3.retry.delay: 1000

# 表配置
tables:
  - name: user_events
    type: streaming
    primary-key: user_id,event_time
    partition-by: event_date
    bucket-key: user_id
    bucket-num: 4
    changelog-producer: input
    merge-engine: deduplicate
    write-only: false
    file-format: parquet
    compression: snappy
    
  - name: sales_data
    type: streaming
    primary-key: id,sale_date
    partition-by: sale_date
    bucket-key: id
    bucket-num: 4
    changelog-producer: input
    merge-engine: deduplicate
    write-only: false
    file-format: parquet
    compression: snappy
    
  - name: word_count
    type: streaming
    primary-key: word,window_start
    partition-by: window_date
    bucket-key: word
    bucket-num: 4
    changelog-producer: input
    merge-engine: deduplicate
    write-only: false
    file-format: parquet
    compression: snappy

# 存储配置
storage:
  # 文件格式
  file-format: parquet
  
  # 压缩格式
  compression: snappy
  
  # 文件大小
  target-file-size: 128MB
  
  # 写入缓冲区大小
  write-buffer-size: 256MB
  
  # 读取缓冲区大小
  read-buffer-size: 64MB
  
  # 合并策略
  merge-engine: deduplicate
  
  # 变更日志生产者
  changelog-producer: input
  
  # 文件过期时间
  file-expiration: 7d
  
  # 快照过期时间
  snapshot.expire.duration: 7d
  
  # 快照保留数量
  snapshot.num-retained.min: 10
  snapshot.num-retained.max: 100

# 检查点配置
checkpoint:
  # 检查点间隔
  interval: 60s
  
  # 检查点超时
  timeout: 10min
  
  # 最小暂停时间
  min-pause: 5s
  
  # 最大并发检查点
  max-concurrent: 1
  
  # 外部化检查点
  externalized: true
  
  # 保留策略
  retention: 2

# 水印配置
watermark:
  # 水印策略
  strategy: process-time
  
  # 水印延迟
  delay: 5s
  
  # 水印空闲超时
  idle-timeout: 60s

# 优化配置
optimization:
  # 小文件合并
  merge-small-files: true
  
  # 小文件阈值
  small-file-threshold: 32MB
  
  # 合并策略
  merge-strategy: size
  
  # 并发度
  parallelism: 4
  
  # 内存配置
  memory-size: 1GB
  
  # 网络缓冲区
  network-buffer-timeout: 60s 